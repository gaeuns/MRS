<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>커뮤니티 - 무비리뷰</title>
    <link rel="stylesheet" th:href="@{/main.css}">
    <link rel="stylesheet" th:href="@{/board.css}">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<header class="site-header">
    <div class="container">
        <div class="logo">
            <h1><a th:href="@{/}">무비리뷰</a></h1>
        </div>
        <nav class="main-nav">
            <ul>
                <li><a th:href="@{/}">홈</a></li>
                <li><a th:href="@{/movies}">영화</a></li>
                <li><a th:href="@{/reviews}">리뷰</a></li>
                <li><a th:href="@{/rankings}">랭킹</a></li>
                <li><a th:href="@{/community}" class="active">커뮤니티</a></li>
            </ul>
        </nav>
        <div class="user-actions">
            <div class="user-profile" th:if="${session.user != null}">
                <span th:text="${session.user.userName}">사용자</span>
                <a th:href="@{/mypage}" class="profile-link">마이페이지</a>
                <a th:href="@{/logout}" class="logout-link">로그아웃</a>
            </div>
            <div class="auth-buttons" th:if="${session.user == null}">
                <a th:href="@{/login}" class="btn btn-login">로그인</a>
                <a th:href="@{/signup}" class="btn btn-register">회원가입</a>
            </div>
        </div>
    </div>
</header>

<main class="board-main">
    <div class="container">
        <!-- 페이지 헤더 -->
        <div class="board-header">
            <h1>커뮤니티</h1>
            <p>영화에 대한 다양한 이야기를 나누어보세요!</p>
            <div class="breadcrumb">
                <a th:href="@{/}">홈</a> > <span>커뮤니티</span>
            </div>
        </div>

        <!-- 필터 및 검색 -->
        <div class="board-filter">
            <div class="filter-tabs">
                <a th:href="@{/community(category='ALL')}"
                   th:class="${category == 'ALL' or category == null} ? 'filter-tab active' : 'filter-tab'">전체</a>
                <a th:href="@{/community(category='DISCUSSION')}"
                   th:class="${category == 'DISCUSSION'} ? 'filter-tab active' : 'filter-tab'">자유토론</a>
                <a th:href="@{/community(category='RECOMMENDATION')}"
                   th:class="${category == 'RECOMMENDATION'} ? 'filter-tab active' : 'filter-tab'">영화추천</a>
                <a th:href="@{/community(category='QUESTION')}"
                   th:class="${category == 'QUESTION'} ? 'filter-tab active' : 'filter-tab'">질문답변</a>
                <a th:href="@{/community(category='SPOILER')}"
                   th:class="${category == 'SPOILER'} ? 'filter-tab active' : 'filter-tab'">스포일러</a>
            </div>

            <div class="search-sort">
                <form th:action="@{/community}" method="get" class="search-form">
                    <input type="hidden" name="category" th:value="${category}">
                    <input type="hidden" name="sort" th:value="${sort}">
                    <input type="text" name="keyword" th:value="${keyword}"
                           placeholder="제목이나 내용을 검색하세요" class="search-input">
                    <button type="submit" class="btn btn-primary">검색</button>
                </form>

                <div class="write-action">
                    <a th:if="${session.user != null}" th:href="@{/community/write}"
                       class="btn btn-write">
                        <span>✍️</span> 글쓰기
                    </a>
                    <a th:if="${session.user == null}" th:href="@{/login}"
                       class="btn btn-write">
                        <span>✍️</span> 글쓰기
                    </a>
                </div>

                <div class="sort-options">
                    <select onchange="location.href=this.value" class="sort-select">
                        <option value="" th:selected="${sort == null}">정렬 기준</option>
                        <option th:value="@{/community(category=${category}, keyword=${keyword}, sort='latest')}"
                                th:selected="${sort == 'latest'}">최신순</option>
                        <option th:value="@{/community(category=${category}, keyword=${keyword}, sort='popular')}"
                                th:selected="${sort == 'popular'}">인기순</option>
                        <option th:value="@{/community(category=${category}, keyword=${keyword}, sort='comments')}"
                                th:selected="${sort == 'comments'}">댓글순</option>
                        <option th:value="@{/community(category=${category}, keyword=${keyword}, sort='views')}"
                                th:selected="${sort == 'views'}">조회순</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- 게시글 목록 -->
        <div class="board-list">
            <div th:each="post : ${posts}" class="board-item">
                <div class="board-item-header">
                    <div class="board-content-area">
                        <div class="board-category" th:text="${post.category}">자유토론</div>
                        <h3 class="board-title">
                            <a th:href="@{/community/{id}(id=${post.id})}" th:text="${post.title}">게시글 제목</a>
                            <span th:if="${post.commentCount > 0}" class="comment-count"
                                  th:text="'[' + ${post.commentCount} + ']'">[5]</span>
                            <span th:if="${post.isNew}" class="new-badge">NEW</span>
                            <span th:if="${post.hasImages}" class="image-badge">📷</span>
                        </h3>
                        <div class="board-meta">
                            <span class="board-author" th:text="${post.user.userId}">작성자</span>
                            <span class="board-date" th:text="${#temporals.format(post.createDate, 'MM.dd')}">12.25 14:30</span>
                            <div class="board-stats">
                                <span class="views" th:text="'조회 ' + ${post.viewCount}">조회 24</span>
                                <span class="likes" th:text="'추천 ' + ${post.likeCount}">추천 5</span>
                            </div>
                        </div>
                    </div>
                    <div class="board-preview" th:if="${post.previewContent}">
                        <p th:text="${post.previewContent}">게시글 내용의 일부가 미리보기로 표시됩니다...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 게시글이 없을 때 -->
        <div th:if="${posts == null or posts.empty}" class="empty-board">
            <div class="empty-icon">💬</div>
            <h3>게시글이 없습니다</h3>
            <p th:if="${keyword != null}">검색 결과가 없습니다. 다른 검색어로 시도해보세요.</p>
            <p th:if="${keyword == null}">첫 번째 게시글을 작성해보세요!</p>
            <a th:if="${session.user != null}" th:href="@{/community/write}"
               class="btn btn-primary">
                <span>✍️</span> 첫 글 작성하기
            </a>
            <a th:if="${session.user == null}" th:href="@{/login}"
               class="btn btn-primary">
                <span>✍️</span> 로그인 후 글 작성
            </a>
        </div>

        <!-- 페이지네이션 -->
        <div th:if="${postPage != null and postPage.totalPages > 1}" class="pagination">
            <a th:if="${postPage.hasPrevious()}"
               th:href="@{/community(page=${postPage.number - 1}, category=${category}, keyword=${keyword}, sort=${sort})}"
               class="page-btn">이전</a>

            <span th:each="i : ${#numbers.sequence(0, postPage.totalPages - 1)}"
                  th:if="${i >= postPage.number - 2 and i <= postPage.number + 2}"
                  th:class="${i == postPage.number} ? 'page-btn active' : 'page-btn'">
                    <a th:href="@{/community(page=${i}, category=${category}, keyword=${keyword}, sort=${sort})}"
                       th:text="${i + 1}">1</a>
                </span>

            <a th:if="${postPage.hasNext()}"
               th:href="@{/community(page=${postPage.number + 1}, category=${category}, keyword=${keyword}, sort=${sort})}"
               class="page-btn">다음</a>
        </div>

        <!-- 커뮤니티 안내 -->
        <div class="community-guide">
            <h4>📢 커뮤니티 이용 안내</h4>
            <ul>
                <li><strong>자유토론:</strong> 영화에 대한 자유로운 의견 교환 및 토론</li>
                <li><strong>영화추천:</strong> 다른 사용자에게 영화 추천 및 소개</li>
                <li><strong>질문답변:</strong> 영화 관련 궁금한 점이나 질문</li>
                <li><strong>스포일러:</strong> 영화 내용 누설이 포함된 글 (주의 필요)</li>
                <li>서로를 존중하는 건전한 토론 문화를 만들어가요!</li>
                <li>스포일러가 포함된 내용은 반드시 해당 카테고리를 선택해주세요.</li>
            </ul>
        </div>
    </div>
</main>

<footer class="site-footer">
    <div class="container">
        <p>&copy; 2023 무비리뷰. All rights reserved.</p>
    </div>
</footer>
</body>
</html>
