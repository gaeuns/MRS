<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>프로필 수정 - 무비리뷰</title>
  <link rel="stylesheet" th:href="@{/main.css}">
  <link rel="stylesheet" th:href="@{/mypage.css}">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<header class="site-header">
  <div class="container">
    <div class="logo">
      <h1><a th:href="@{/}">무비리뷰</a></h1>
    </div>
    <nav class="main-nav">
      <ul>
        <li><a th:href="@{/}">홈</a></li>
        <li><a th:href="@{/movies}">영화</a></li>
        <li><a th:href="@{/community}">커뮤니티</a></li>
        <li><a th:href="@{/notice}">공지사항</a></li>
      </ul>
    </nav>
    <div class="user-actions">
      <div class="user-profile">
        <span th:text="${session.user.userName}">사용자</span>
        <a th:href="@{/mypage}" class="profile-link">마이페이지</a>
        <a th:href="@{/logout}" class="logout-link">로그아웃</a>
      </div>
    </div>
  </div>
</header>

<main class="mypage-main">
  <div class="container">
    <div class="edit-header">
      <h1>프로필 수정</h1>
      <a th:href="@{/mypage}" class="btn btn-secondary">돌아가기</a>
    </div>

    <div class="edit-content">
      <div class="profile-edit-section">
        <!-- 에러 메시지 -->
        <div th:if="${error}" class="alert alert-error">
          <span th:text="${error}">프로필 수정 중 오류가 발생했습니다.</span>
        </div>

        <form th:action="@{/mypage/edit}" th:object="${userUpdateForm}" method="post" enctype="multipart/form-data">

          <div class="form-group">
            <label for="userName">이름</label>
            <input type="text" id="userName" th:field="*{userName}"
                   th:classappend="${#fields.hasErrors('userName')} ? 'error' : ''" required>
            <div th:if="${#fields.hasErrors('userName')}" class="field-error">
              <span th:errors="*{userName}">이름 오류</span>
            </div>
          </div>

          <div class="form-group">
            <label for="email">이메일</label>
            <input type="email" id="email" th:field="*{email}"
                   th:classappend="${#fields.hasErrors('email')} ? 'error' : ''" required>
            <div th:if="${#fields.hasErrors('email')}" class="field-error">
              <span th:errors="*{email}">이메일 오류</span>
            </div>
          </div>

          <div class="password-section">
            <h3>비밀번호 변경 (선택사항)</h3>
            <p class="section-description">비밀번호를 변경하지 않으려면 아래 필드들을 비워두세요.</p>

            <div class="form-group">
              <label for="currentPassword">현재 비밀번호</label>
              <input type="password" id="currentPassword" th:field="*{currentPassword}"
                     placeholder="현재 비밀번호를 입력하세요">
              <div th:if="${#fields.hasErrors('currentPassword')}" class="field-error">
                <span th:errors="*{currentPassword}">현재 비밀번호 오류</span>
              </div>
            </div>

            <div class="form-group">
              <label for="newPassword">새 비밀번호</label>
              <input type="password" id="newPassword" th:field="*{newPassword}"
                     placeholder="새 비밀번호를 입력하세요">
              <div th:if="${#fields.hasErrors('newPassword')}" class="field-error">
                <span th:errors="*{newPassword}">새 비밀번호 오류</span>
              </div>
              <small class="form-help">최소 8자, 대소문자, 숫자, 특수문자 포함</small>
            </div>

            <div class="form-group">
              <label for="confirmPassword">새 비밀번호 확인</label>
              <input type="password" id="confirmPassword" th:field="*{confirmPassword}"
                     placeholder="새 비밀번호를 다시 입력하세요">
              <div th:if="${#fields.hasErrors('confirmPassword')}" class="field-error">
                <span th:errors="*{confirmPassword}">비밀번호 확인 오류</span>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <a th:href="@{/mypage}" class="btn btn-secondary">취소</a>
            <button type="submit" class="btn btn-primary">저장</button>
          </div>

        </form>
      </div>
    </div>
  </div>
</main>

<footer class="site-footer">
  <div class="container">
    <p>&copy; 2023 무비리뷰. All rights reserved.</p>
  </div>
</footer>
</body>
</html>