<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${review != null ? '리뷰 수정 - ' + movie.title : '리뷰 작성 - ' + movie.title} + ' - 무비리뷰'">리뷰 작성 - 영화 제목 - 무비리뷰</title>
    <link rel="stylesheet" th:href="@{/main.css}">
    <link rel="stylesheet" th:href="@{/movies.css}">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<header class="site-header">
    <div class="container">
        <div class="logo">
            <h1><a th:href="@{/}">무비리뷰</a></h1>
        </div>
        <nav class="main-nav">
            <ul>
                <li><a th:href="@{/}">홈</a></li>
                <li><a th:href="@{/movies}" class="active">영화</a></li>
                <li><a th:href="@{/reviews}">리뷰</a></li>
                <li><a th:href="@{/rankings}">랭킹</a></li>
                <li><a th:href="@{/community}">커뮤니티</a></li>
            </ul>
        </nav>
        <div class="user-actions">
            <div class="user-profile" th:if="${session.user != null}">
                <span th:text="${session.user.userName}">사용자</span>
                <a th:href="@{/mypage}" class="profile-link">마이페이지</a>
                <a th:href="@{/logout}" class="logout-link">로그아웃</a>
            </div>
        </div>
    </div>
</header>

<main class="review-write-main">
    <div class="container">
        <!-- 뒤로가기 -->
        <div class="breadcrumb">
            <a th:href="@{/}">홈</a> > <a th:href="@{/movies}">영화</a> >
            <a th:href="@{/movies/{id}(id=${movie.id})}" th:text="${movie.title}">영화 제목</a> >
            <span th:text="${hasReview ? '리뷰 수정' : '리뷰 작성'}">리뷰 작성</span>
        </div>

        <div class="review-write-container">
            <!-- 영화 정보 요약 -->
            <div class="movie-summary">
                <div class="movie-summary-poster">
                    <img th:src="${movie.posterUrl != null ? movie.posterUrl : '/placeholder.svg?height=300&width=200'}"
                         th:alt="${movie.title}">
                </div>
                <div class="movie-summary-info">
                    <h2 class="movie-title" th:text="${movie.title}">영화 제목</h2>
                    <p class="movie-meta">
                        <span th:text="${movie.releaseDate}">2023</span> |
                        <span th:text="${movie.category}">액션, 드라마</span> |
                        <span th:text="${movie.runtime} + '분'">120분</span>
                    </p>
                    <div class="movie-rating">
                        <span class="rating-star">★</span>
                        <span class="rating-score" th:text="${movie.averageRating != null ? #numbers.formatDecimal(movie.averageRating, 1, 1) : 'N/A'}">8.5</span>
                        <span class="rating-count" th:text="'(' + ${movie.reviewCount} + '명)'">( 124명 )</span>
                    </div>
                </div>
            </div>

            <!-- 리뷰 작성 폼 -->
            <form th:action="${hasReview ? '/movies/' + movie.id + '/review/' + review.id + '/edit' : '/movies/' + movie.id + '/review'}"
                  method="post" class="review-form">
                <input type="hidden" name="movie.id" th:value="${movie.id}" />

                <!--                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>-->

                <!-- 별점 선택 -->
                <div class="form-group">
                    <label class="form-label">별점 <span class="required">*</span></label>
                    <div class="rating-select">
                        <div class="star-rating-large">
                            <input type="radio" id="star5" name="rating" value="5" th:checked="${review != null && review.rating == 5}" required>
                            <label for="star5" title="5점">★</label>

                            <input type="radio" id="star4" name="rating" value="4" th:checked="${review != null && review.rating == 4}" required>
                            <label for="star4" title="4점">★</label>

                            <input type="radio" id="star3" name="rating" value="3" th:checked="${review != null && review.rating == 3 || review == null}" required>
                            <label for="star3" title="3점">★</label>

                            <input type="radio" id="star2" name="rating" value="2" th:checked="${review != null && review.rating == 2}" required>
                            <label for="star2" title="2점">★</label>

                            <input type="radio" id="star1" name="rating" value="1" th:checked="${review != null && review.rating == 1}" required>
                            <label for="star1" title="1점">★</label>
                        </div>
                    </div>
                    <div class="form-help">영화에 대한 평가를 별점으로 선택해주세요.</div>
                </div>

                <!-- 리뷰 제목 -->
                <div class="form-group">
                    <label for="title" class="form-label">리뷰 제목 <span class="required">*</span></label>
                    <input type="text" id="title" name="title" class="form-input"
                           placeholder="리뷰 제목을 입력해주세요"
                           required th:value="${review != null ? review.title : ''}">
                    <div class="form-help">최대 100자 이내로 입력해주세요.</div>
                </div>

                <!-- 리뷰 내용 -->
                <div class="form-group">
                    <label for="description" class="form-label">리뷰 내용 <span class="required">*</span></label>
                    <textarea id="description" name="description" class="form-textarea"
                              placeholder="이 영화에 대한 생각을 자유롭게 작성해주세요.&#10;&#10;• 영화의 어떤 점이 좋았나요?&#10;• 인상 깊었던 장면이나 대사가 있나요?&#10;• 다른 사람들에게 추천하고 싶은 이유는 무엇인가요?"
                              required th:text="${review != null ? review.description : ''}"></textarea>
                    <div class="form-help">최소 10자 이상 작성해주세요. (최대 5,000자)</div>
                </div>

                <!-- 스포일러 체크 -->
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="hasSpoiler" th:checked="${review != null && review.hasSpoiler}">
                        <span>스포일러 포함</span>
                    </label>
                    <div class="form-help">스포일러가 포함된 내용이라면 체크해주세요. 다른 사용자들에게 경고가 표시됩니다.</div>
                </div>

                <!-- 리뷰 작성 가이드 -->
                <div class="review-guide">
                    <h4>📝 리뷰 작성 가이드</h4>
                    <ul>
                        <li>영화를 실제로 관람한 후 작성해주세요.</li>
                        <li>구체적인 감상과 의견을 담아주세요.</li>
                        <li>다른 사용자들에게 도움이 될 수 있는 내용을 작성해주세요.</li>
                        <li>욕설, 비방, 광고 등 부적절한 내용은 삭제될 수 있습니다.</li>
                        <li>스포일러가 포함된 내용은 반드시 체크해주세요.</li>
                    </ul>
                </div>

                <!-- 버튼 영역 -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <span th:text="${hasReview ? '수정하기' : '작성하기'}">작성하기</span>
                    </button>
                    <a th:href="@{/movies/{id}(id=${movie.id})}" class="btn btn-secondary">취소</a>
                </div>
            </form>
        </div>
    </div>
</main>

<footer class="site-footer">
    <div class="container">
        <p>&copy; 2025 Spring Boot Project</p>
    </div>
</footer>
</body>
</html>
