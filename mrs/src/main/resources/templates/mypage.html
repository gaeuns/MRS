<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>마이페이지 - 무비리뷰</title>
  <link rel="stylesheet" th:href="@{/main.css}">
  <link rel="stylesheet" th:href="@{/mypage.css}">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<header class="site-header">
  <div class="container">
    <div class="logo">
      <h1><a th:href="@{/}">무비리뷰</a></h1>
    </div>
    <nav class="main-nav">
      <ul>
        <li><a th:href="@{/}">홈</a></li>
        <li><a th:href="@{/movies}">영화</a></li>
        <li><a th:href="@{/community}">커뮤니티</a></li>
        <li><a th:href="@{/notice}">공지사항</a></li>
      </ul>
    </nav>
    <div class="user-actions">
      <div class="user-profile">
        <span th:text="${session.user.userName}">사용자</span>
        <a th:href="@{/mypage}" class="profile-link active">마이페이지</a>
        <a th:href="@{/logout}" class="logout-link">로그아웃</a>
      </div>
    </div>
  </div>
</header>

<main class="mypage-main">
  <div class="container">
    <div class="mypage-header">
      <div class="profile-summary">
        <div class="profile-avatar">
          <img th:src="${'/profile.jpg'}"
               th:alt="${user.userName + '의 프로필'}"
               class="avatar-img">
        </div>
        <div class="profile-info">
          <h1 th:text="${user.userName}">사용자 이름</h1>
          <p class="user-stats">
            <span>리뷰 <strong th:text="${reviewCount}">12</strong>개</span>
            <!--<span>찜한 영화 <strong th:text="${wishlistCount}">8</strong>개</span>-->
          </p>
        </div>
      </div>
    </div>

    <div class="mypage-content">
      <!-- 탭 네비게이션 (라디오 버튼 방식) -->
      <div class="tab-navigation">
        <input type="radio" id="tab-profile" name="tab"
               th:checked="${param.tab == null or param.tab[0] == 'profile'}">
        <label for="tab-profile" class="tab-label">프로필</label>

        <input type="radio" id="tab-reviews" name="tab"
               th:checked="${param.tab != null and param.tab[0] == 'reviews'}">
        <label for="tab-reviews" class="tab-label">내 리뷰</label>

        <!-- 프로필 탭 컨텐츠 -->
        <div class="tab-content" id="profile-content">
          <div class="profile-section">
            <div class="section-header">
              <h2>프로필 정보</h2>
              <a th:href="@{/mypage/edit}" class="btn btn-outline">수정하기</a>
            </div>

            <!-- 수정 성공 메시지 -->
            <div th:if="${updateSuccess}" class="alert alert-success">
              <span>프로필이 성공적으로 수정되었습니다.</span>
            </div>

            <!-- 수정 에러 메시지 -->
            <div th:if="${updateError}" class="alert alert-error">
              <span th:text="${updateError}">프로필 수정 중 오류가 발생했습니다.</span>
            </div>

            <div class="info-grid">
              <div class="info-item">
                <label>아이디</label>
                <span th:text="${user.userId}">user123</span>
              </div>
              <div class="info-item">
                <label>이름</label>
                <span th:text="${user.userName}">홍길동</span>
              </div>
              <div class="info-item">
                <label>이메일</label>
                <span th:text="${user.email}">user@example.com</span>
              </div>
            </div>
          </div>
        </div>

        <!-- 내 리뷰 탭 컨텐츠 -->
        <div class="tab-content" id="reviews-content">
          <div class="reviews-section">
            <div class="section-header">
              <h2>내가 작성한 리뷰</h2>
              <div class="review-stats">
                <span>총 <strong th:text="${reviewCount}">12</strong>개의 리뷰</span>
              </div>
            </div>

            <div class="reviews-list">
              <div th:each="review : ${myReviews}" class="review-item">
                <div class="review-movie-info">
                  <img th:src="${review.movie.posterUrl}" th:alt="${review.movie.title}" class="movie-poster-small">
                  <div class="movie-details">
                    <h3 th:text="${review.movie.title}">영화 제목</h3>
                    <p class="movie-genre" th:text="${review.movie.category}">장르</p>
                  </div>
                </div>
                <div class="review-content">
                  <div class="review-header">
                    <div class="review-rating">
                      <span class="rating-score" th:text="${review.rating}">5</span>
                      <div class="stars">
                        <span th:each="i : ${#numbers.sequence(1, 5)}"
                              th:class="${i <= review.rating} ? 'star filled' : 'star'">★</span>
                      </div>
                    </div>

                    <div class="review-date" th:text="${review.createdAt}">2023.06.01</div>
                  </div>
                  <h4 class="review-title" th:text="${review.title}">리뷰 제목</h4>
                  <p class="review-text" th:text="${review.description}">리뷰 내용...</p>
                  <div class="review-actions">
                    <a th:href="@{/review-page/{id}(id=${review.id})}" class="btn btn-sm">상세보기</a>
                    <a th:href="@{/movies/{id}/review(id=${review.movie.id})}" class="btn btn-sm btn-outline">수정</a>
                    <form th:action="@{/movies/{movieId}/review/{reviewId}/delete(movieId=${review.movie.id}, reviewId=${review.id})}"
                          method="post" style="display: inline;">
                      <button type="submit" class="btn btn-sm btn-danger"
                              onclick="return confirm('정말로 이 리뷰를 삭제하시겠습니까?')">삭제</button>
                    </form>
                  </div>
                </div>
              </div>

              <!-- 리뷰가 없을 때 -->
              <div th:if="${myReviews == null}" class="empty-state">
                <div class="empty-icon">📝</div>
                <h3>작성한 리뷰가 없습니다</h3>
                <p>첫 번째 영화 리뷰를 작성해보세요!</p>
                <a th:href="@{/movies}" class="btn btn-primary">영화 둘러보기</a>
              </div>
            </div>

            <!-- 페이지네이션 -->
            <!--<div th:if="${reviewPage != null and reviewPage.totalPages > 1}" class="pagination">
              <a th:if="${reviewPage.hasPrevious()}"
                 th:href="@{/mypage(tab=reviews,page=${reviewPage.number - 1})}"
                 class="page-btn">이전</a>

              <span th:each="i : ${#numbers.sequence(0, reviewPage.totalPages - 1)}"
                    th:class="${i == reviewPage.number} ? 'page-btn active' : 'page-btn'">
                                    <a th:href="@{/mypage(tab=reviews,page=${i})}" th:text="${i + 1}">1</a>
                                </span>

              <a th:if="${reviewPage.hasNext()}"
                 th:href="@{/mypage(tab=reviews,page=${reviewPage.number + 1})}"
                 class="page-btn">다음</a>
            </div>-->
          </div>
        </div>

        <!-- 찜한 영화 탭 컨텐츠 -->
        <!--<div class="tab-content" id="wishlist-content">
          <div class="wishlist-section">
            <div class="section-header">
              <h2>찜한 영화</h2>
              <div class="wishlist-stats">
                <span>총 <strong th:text="${wishlistCount}">8</strong>개의 영화</span>
              </div>
            </div>

            <div class="movies-grid">
              <div th:each="movie : ${wishlistMovies}" class="movie-card">
                <div class="movie-poster">
                  <img th:src="${movie.posterUrl}" th:alt="${movie.title}">
                  <div class="movie-rating" th:text="${movie.rating}">8.5</div>
                  <form th:action="@{/wishlist/{id}/remove(id=${movie.id})}" method="post" class="wishlist-remove-form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="wishlist-remove"
                            onclick="return confirm('찜 목록에서 이 영화를 제거하시겠습니까?')">❤️</button>
                  </form>
                </div>
                <div class="movie-info">
                  <h3 class="movie-title" th:text="${movie.title}">영화 제목</h3>
                  <p class="movie-genre" th:text="${movie.genre}">장르</p>
                  <p class="movie-year" th:text="${movie.releaseYear}">2023</p>
                  <div class="movie-actions">
                    <a th:href="@{/movies/{id}(id=${movie.id})}" class="btn btn-sm">상세보기</a>
                    <a th:href="@{/reviews/write?movieId={id}(id=${movie.id})}" class="btn btn-sm btn-primary">리뷰 작성</a>
                  </div>
                </div>
              </div>

              &lt;!&ndash; 찜한 영화가 없을 때 &ndash;&gt;
              <div th:if="${wishlistMovies == null or wishlistMovies.empty}" class="empty-state">
                <div class="empty-icon">💖</div>
                <h3>찜한 영화가 없습니다</h3>
                <p>마음에 드는 영화를 찜해보세요!</p>
                <a th:href="@{/movies}" class="btn btn-primary">영화 둘러보기</a>
              </div>
            </div>

            &lt;!&ndash; 페이지네이션 &ndash;&gt;
            <div th:if="${wishlistPage != null and wishlistPage.totalPages > 1}" class="pagination">
              <a th:if="${wishlistPage.hasPrevious()}"
                 th:href="@{/mypage(tab=wishlist,page=${wishlistPage.number - 1})}"
                 class="page-btn">이전</a>

              <span th:each="i : ${#numbers.sequence(0, wishlistPage.totalPages - 1)}"
                    th:class="${i == wishlistPage.number} ? 'page-btn active' : 'page-btn'">
                                    <a th:href="@{/mypage(tab=wishlist,page=${i})}" th:text="${i + 1}">1</a>
                                </span>

              <a th:if="${wishlistPage.hasNext()}"
                 th:href="@{/mypage(tab=wishlist,page=${wishlistPage.number + 1})}"
                 class="page-btn">다음</a>
            </div>
          </div>
        </div>-->
      </div>
    </div>
  </div>
</main>

<footer class="site-footer">
  <div class="container">
    <p>&copy; 2023 무비리뷰. All rights reserved.</p>
  </div>
</footer>
</body>
</html>